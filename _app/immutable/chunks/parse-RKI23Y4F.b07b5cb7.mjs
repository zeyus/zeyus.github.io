import{_ as w}from"./preload-helper.a4192956.mjs";import{u as x,p as T}from"./register-C7DORXC6.e162c789.mjs";var g=/^Format:[\s\t]*/,j=/^Style:[\s\t]*/,R=/^Dialogue:[\s\t]*/,m=/[\s\t]*,[\s\t]*/,v=/\{[^}]+\}/g,y=/\\N/g,I=/^\[(.*)[\s\t]?Styles\]$/,b=/^\[(.*)[\s\t]?Events\]$/,F=class{constructor(){this.m=0,this.a=null,this.d=[],this.p=[],this.j=null,this.K={}}async init(t){this.f=t,t.errors&&(this.e=(await w(()=>import("./errors-7ZCJBJFL.078070ef.mjs"),["./errors-7ZCJBJFL.078070ef.mjs","./register-C7DORXC6.e162c789.mjs","./preload-helper.a4192956.mjs"],import.meta.url)).ParseErrorBuilder)}parse(t,a){var e,s;if(this.m)switch(this.m){case 1:if(t==="")this.m=0;else if(j.test(t))if(this.j){const r=t.replace(j,"").split(m);this.U(r)}else this.h((e=this.e)==null?void 0:e.H("Style",a));else g.test(t)?this.j=t.replace(g,"").split(m):b.test(t)&&(this.j=null,this.m=2);break;case 2:if(t==="")this.L();else if(R.test(t))if(this.L(),this.j){const r=t.replace(R,"").split(m),i=this.V(r,a);i&&(this.a=i)}else this.h((s=this.e)==null?void 0:s.H("Dialogue",a));else this.a?this.a.text+=`
`+t.replace(v,"").replace(y,`
`):g.test(t)?this.j=t.replace(g,"").split(m):I.test(t)?(this.j=null,this.m=1):b.test(t)&&(this.j=null)}else t===""||(I.test(t)?(this.j=null,this.m=1):b.test(t)&&(this.j=null,this.m=2))}done(){return{metadata:{},cues:this.d,regions:[],errors:this.p}}L(){var t,a;this.a&&(this.d.push(this.a),(a=(t=this.f).onCue)==null||a.call(t,this.a),this.a=null)}U(t){let a="Default",e={},s,r="center",i="bottom",o,c=1.2,n,u,h=3,p=[];for(let f=0;f<this.j.length;f++){const M=this.j[f],l=t[f];switch(M){case"Name":a=l;break;case"Fontname":e["font-family"]=l;break;case"Fontsize":e["font-size"]=`calc(${l} / var(--overlay-height))`;break;case"PrimaryColour":const _=S(l);_&&(e["--cue-color"]=_);break;case"BorderStyle":h=parseInt(l,10);break;case"BackColour":u=S(l);break;case"OutlineColour":const E=S(l);E&&(n=E);break;case"Bold":parseInt(l)&&(e["font-weight"]="bold");break;case"Italic":parseInt(l)&&(e["font-style"]="italic");break;case"Underline":parseInt(l)&&(e["text-decoration"]="underline");break;case"StrikeOut":parseInt(l)&&(e["text-decoration"]="line-through");break;case"Spacing":e["letter-spacing"]=l+"px";break;case"AlphaLevel":e.opacity=parseFloat(l);break;case"ScaleX":p.push(`scaleX(${parseFloat(l)/100})`);break;case"ScaleY":p.push(`scaleY(${parseFloat(l)/100})`);break;case"Angle":p.push(`rotate(${l}deg)`);break;case"Shadow":c=parseInt(l,10)*1.2;break;case"MarginL":e["--cue-width"]="auto",e["--cue-left"]=parseFloat(l)+"px";break;case"MarginR":e["--cue-width"]="auto",e["--cue-right"]=parseFloat(l)+"px";break;case"MarginV":o=parseFloat(l);break;case"Outline":s=parseInt(l,10);break;case"Alignment":const d=parseInt(l,10);switch(d>=4&&(i=d>=7?"top":"center"),d%3){case 1:r="start";break;case 2:r="center";break;case 3:r="end";break}}}if(e.M=i,e["--cue-white-space"]="normal",e["--cue-line-height"]="normal",e["--cue-text-align"]=r,i==="center"?(e["--cue-top"]="50%",p.push("translateY(-50%)")):e[`--cue-${i}`]=(o||0)+"px",h===1&&(e["--cue-padding-y"]="0"),(h===1||u)&&(e["--cue-bg-color"]=h===1?"none":u),h===3&&n&&(e["--cue-outline"]=`${s}px solid ${n}`),h===1&&typeof s=="number"){const f=u??"#000";e["--cue-text-shadow"]=[n&&k(s*1.2,c*1.2,n),n?k(s*(s/2),c*(s/2),f):k(s,c,f)].filter(Boolean).join(", ")}p.length&&(e["--cue-transform"]=p.join(" ")),this.K[a]=e}V(t,a){const e=this.W(t),s=this.o(e.Start,e.End,a);if(!s)return;const r=new x(s[0],s[1],""),i={...this.K[e.Style]||{}},o=e.Name?`<v ${e.Name}>`:"",c=i.M,n=e.MarginL&&parseFloat(e.MarginL),u=e.MarginR&&parseFloat(e.MarginR),h=e.MarginV&&parseFloat(e.MarginV);return n&&(i["--cue-width"]="auto",i["--cue-left"]=n+"px"),u&&(i["--cue-width"]="auto",i["--cue-right"]=u+"px"),h&&c!=="center"&&(i[`--cue-${c}`]=h+"px"),r.text=o+t.slice(this.j.length-1).join(", ").replace(v,"").replace(y,`
`),delete i.M,Object.keys(i).length&&(r.style=i),r}W(t){const a={};for(let e=0;e<this.j.length;e++)a[this.j[e]]=t[e];return a}o(t,a,e){var i,o,c;const s=T(t),r=T(a);if(s!==null&&r!==null&&r>s)return[s,r];s===null&&this.h((i=this.e)==null?void 0:i.E(t,e)),r===null&&this.h((o=this.e)==null?void 0:o.F(a,e)),s!=null&&r!==null&&r>s&&this.h((c=this.e)==null?void 0:c.G(s,r,e))}h(t){var a,e;if(t){if(this.p.push(t),this.f.strict)throw this.f.cancel(),t;(e=(a=this.f).onError)==null||e.call(a,t)}}};function S(t){const a=parseInt(t.replace("&H",""),16);if(a>=0){const s=(a>>24&255^255)/255,r=a>>16&255,i=a>>8&255;return"rgba("+[a&255,i,r,s].join(",")+")"}return null}function k(t,a,e){const s=Math.ceil(2*Math.PI*t);let r="";for(let i=0;i<s;i++){const o=2*Math.PI*i/s;r+=t*Math.cos(o)+"px "+a*Math.sin(o)+"px 0 "+e+(i==s-1?"":",")}return r}function O(){return new F}export{F as SSAParser,O as default};
