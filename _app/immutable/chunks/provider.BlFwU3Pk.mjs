var k=Object.defineProperty;var y=(d,i,t)=>i in d?k(d,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[i]=t;var n=(d,i,t)=>y(d,typeof i!="symbol"?i+"":i,t);import{j as p,D as l,E as f,q as u,u as T,T as v,m as L,v as E,L as c,S as w,w as g,I as z,i as j,x as S,y as A,o as _,z as q,B as O,C as R,F as m,G as M,H as N,J as I,K as C,d as P}from"./register.3VdNnJgm.mjs";class b{constructor(i){n(this,"xi");this.jf=i}O(){j(this.xi)&&this.yi()}P(){S(this.xi)&&window.cancelAnimationFrame(this.xi),this.xi=void 0}yi(){this.xi=window.requestAnimationFrame(()=>{j(this.xi)||(this.jf(),this.yi())})}}const $=d=>A(d);class V{constructor(i){n(this,"ph");n(this,"za",null);n(this,"qh",null);n(this,"nh",{});n(this,"oh",new Set);this.qa=i}get instance(){return this.za}setup(i,t){this.ph=t;const s=p(t.$store.streamType).includes("live"),a=p(t.$store.streamType).includes("ll-");this.za=new i({lowLatencyMode:a,backBufferLength:a?4:s?8:void 0,renderTextTracksNatively:!1,...this.nh});const e=this.rh.bind(this);for(const h of Object.values(i.Events))this.za.on(h,e);this.za.on(i.Events.ERROR,this.Wb.bind(this));for(const h of this.oh)h(this.za);t.player.dispatchEvent(new l("hls-instance",{detail:this.za})),this.za.attachMedia(this.qa),this.za.on(i.Events.AUDIO_TRACK_SWITCHED,this.sh.bind(this)),this.za.on(i.Events.LEVEL_SWITCHED,this.th.bind(this)),this.za.on(i.Events.LEVEL_LOADED,this.uh.bind(this)),this.za.on(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,this.vh.bind(this)),this.za.on(i.Events.CUES_PARSED,this.wh.bind(this)),t.qualities[f]=this.xh.bind(this),u(t.qualities,"change",this.Pf.bind(this)),u(t.audioTracks,"change",this.yh.bind(this)),this.qh=T(this.zh.bind(this))}zh(){if(!this.ph.$store.live())return;const i=new b(this.Ah.bind(this));return i.O(),i.P.bind(i)}Ah(){var i;this.ph.$store.liveSyncPosition.set(((i=this.za)==null?void 0:i.liveSyncPosition)??1/0)}rh(i,t){this.ph.player.dispatchEvent(new l($(i),{detail:t}))}vh(i,t){const s=new l(i,{detail:t});let a=-1;for(let e=0;e<t.tracks.length;e++){const h=t.tracks[e],o=h.subtitleTrack??h.closedCaptions,r=new v({id:`hls-${h.kind}${e}`,src:o==null?void 0:o.url,label:h.label,language:o==null?void 0:o.lang,kind:h.kind});r[L]=2,r[E]=()=>{r.mode==="showing"?(this.za.subtitleTrack=e,a=e):a===e&&(this.za.subtitleTrack=-1,a=-1)},h.default&&r.setMode("showing",s),this.ph.textTracks.add(r,s)}}wh(i,t){const s=this.ph.textTracks.getById(`hls-${t.track}`);if(!s)return;const a=new l(i,{detail:t});for(const e of t.cues)e.positionAlign="auto",s.addCue(e,a)}sh(i,t){const s=this.ph.audioTracks[t.id];s&&this.ph.audioTracks[c](s,!0,new l(i,{detail:t}))}th(i,t){const s=this.ph.qualities[t.level];s&&this.ph.qualities[c](s,!0,new l(i,{detail:t}))}uh(i,t){if(this.ph.$store.canPlay())return;const{type:s,live:a,totalduration:e}=t.details,h=new l(i,{detail:t});this.ph.delegate.p("stream-type-change",{detail:a?s==="EVENT"&&Number.isFinite(e)?"live:dvr":"live":"on-demand",trigger:h}),this.ph.delegate.p("duration-change",{detail:e,trigger:h});const o=this.za.media;this.za.currentLevel===-1&&this.ph.qualities[w](!0,h);for(const r of this.za.audioTracks)this.ph.audioTracks[g]({id:r.id+"",label:r.name,language:r.lang||"",kind:"main"},h);for(const r of this.za.levels)this.ph.qualities[g]({width:r.width,height:r.height,codec:r.codecSet,bitrate:r.bitrate},h);o.dispatchEvent(new l("canplay",{trigger:h}))}Wb(i,t){var s,a,e;if(t.fatal)switch(t.type){case"networkError":(s=this.za)==null||s.startLoad();break;case"mediaError":(a=this.za)==null||a.recoverMediaError();break;default:(e=this.za)==null||e.destroy(),this.za=null;break}}xh(){this.za&&(this.za.currentLevel=-1)}Pf(){const{qualities:i}=this.ph;!this.za||i.auto||(this.za[i.switch+"Level"]=i.selectedIndex,z&&(this.qa.currentTime=this.qa.currentTime))}yh(){const{audioTracks:i}=this.ph;this.za&&this.za.audioTrack!==i.selectedIndex&&(this.za.audioTrack=i.selectedIndex)}Jg(){var i,t;this.ph&&(this.ph.qualities[f]=void 0),(i=this.za)==null||i.destroy(),this.za=null,(t=this.qh)==null||t.call(this),this.qh=null}}class D{constructor(i,t){n(this,"ih",q());n(this,"Nh",!1);n(this,"Qh",!1);n(this,"Rh",!1);n(this,"Oh",new b(this.Wh.bind(this)));n(this,"ni");n(this,"pi");this.q=i,this.ph=t,this.Uh(),T(this.Vh.bind(this)),_(this.Eh.bind(this))}get j(){return this.q.media}get jg(){return this.ph.delegate}Eh(){this.Oh.P(),this.ih.empty()}Wh(){const i=this.q.currentTime;this.ph.$store.currentTime()!==i&&this.Mh(i)}Uh(){this.Lh("loadstart",this.ge),this.Lh("abort",this.Sh),this.Lh("emptied",this.Xh),this.Lh("error",this.Wb)}Yh(){this.Qh||(this.ih.add(this.Lh("loadeddata",this.Zh),this.Lh("loadedmetadata",this._h),this.Lh("canplay",this.Rb),this.Lh("canplaythrough",this.$h),this.Lh("durationchange",this.ai),this.Lh("play",this.bi),this.Lh("progress",this.ci),this.Lh("stalled",this.di),this.Lh("suspend",this.ei)),this.Qh=!0)}fi(){this.Rh||(this.ih.add(this.Lh("pause",this.gi),this.Lh("playing",this.hi),this.Lh("ratechange",this.ii),this.Lh("seeked",this.ji),this.Lh("seeking",this.ki),this.Lh("ended",this.li),this.Lh("volumechange",this.ac),this.Lh("waiting",this.mi)),this.Rh=!0)}Lh(i,t){return u(this.j,i,t.bind(this))}qi(i){}Mh(i,t){this.jg.p("time-update",{detail:{currentTime:Math.min(i,this.ph.$store.seekableEnd()),played:this.j.played},trigger:t})}ge(i){if(this.j.networkState===3){this.Sh(i);return}this.Yh(),this.jg.p("load-start",{trigger:i})}Sh(i){this.jg.p("abort",{trigger:i})}Xh(){this.jg.p("emptied",{trigger:event})}Zh(i){this.jg.p("loaded-data",{trigger:i})}_h(i){this.Th(),this.fi(),this.jg.p("volume-change",{detail:{volume:this.j.volume,muted:this.j.muted}}),this.jg.p("loaded-metadata",{trigger:i}),O&&R(this.ph.$store.source())&&this.jg.lf(this.Ph(),i)}Ph(){return{duration:this.j.duration,buffered:this.j.buffered,seekable:this.j.seekable}}Th(){const i=!Number.isFinite(this.j.duration);this.jg.p("stream-type-change",{detail:i?"live":"on-demand"})}bi(i){this.ph.$store.canPlay&&this.jg.p("play",{trigger:i})}gi(i){this.j.readyState===1&&!this.Nh||(this.Nh=!1,this.Oh.P(),this.jg.p("pause",{trigger:i}))}Rb(i){this.jg.lf(this.Ph(),i)}$h(i){this.ph.$store.started()||this.jg.p("can-play-through",{trigger:i,detail:this.Ph()})}hi(i){this.Nh=!1,this.jg.p("playing",{trigger:i}),this.Oh.O()}di(i){this.jg.p("stalled",{trigger:i}),this.j.readyState<3&&(this.Nh=!0,this.jg.p("waiting",{trigger:i}))}mi(i){this.j.readyState<3&&(this.Nh=!0,this.jg.p("waiting",{trigger:i}))}li(i){this.Oh.P(),this.Mh(this.j.duration,i),this.jg.p("end",{trigger:i}),this.ph.$store.loop()?this.oi():this.jg.p("ended",{trigger:i})}Vh(){this.ph.$store.paused()&&u(this.j,"timeupdate",this.Vb.bind(this))}Vb(i){this.Mh(this.j.currentTime,i)}ai(i){this.Th(),this.ph.$store.ended()&&this.Mh(this.j.duration,i),this.jg.p("duration-change",{detail:this.j.duration,trigger:i})}ac(i){this.jg.p("volume-change",{detail:{volume:this.j.volume,muted:this.j.muted},trigger:i})}ji(i){this.Mh(this.j.currentTime,i),this.jg.p("seeked",{detail:this.j.currentTime,trigger:i}),Math.trunc(this.j.currentTime)===Math.trunc(this.j.duration)&&m(this.j.duration)>m(this.j.currentTime)&&(this.Mh(this.j.duration,i),this.j.ended||this.ph.player.dispatchEvent(new l("media-play-request",{trigger:i})))}ki(i){this.jg.p("seeking",{detail:this.j.currentTime,trigger:i})}ci(i){this.jg.p("progress",{detail:{buffered:this.j.buffered,seekable:this.j.seekable},trigger:i})}oi(){M(this.j.controls)&&(this.j.controls=!1),this.ph.player.dispatchEvent(new l("media-loop-request"))}ei(i){this.jg.p("suspend",{trigger:i})}ii(i){this.jg.p("rate-change",{detail:this.j.playbackRate,trigger:i})}Wb(i){const t=this.j.error;t&&this.jg.p("error",{detail:{message:t.message,code:t.code,mediaError:t},trigger:i})}}class U{constructor(i,t){this.q=i,this.ph=t,this.ri.onaddtrack=this.ti.bind(this),this.ri.onremovetrack=this.ui.bind(this),this.ri.onchange=this.vi.bind(this),u(this.ph.audioTracks,"change",this.wi.bind(this))}get ri(){return this.q.media.audioTracks}ti(i){const t=i.track;if(t.label==="")return;const s={id:t.id+"",label:t.label,language:t.language,kind:t.kind,selected:!1};this.ph.audioTracks[g](s,i),t.enabled&&(s.selected=!0)}ui(i){const t=this.ph.audioTracks.getById(i.track.id);t&&this.ph.audioTracks[N](t,i)}vi(i){let t=this.si();if(!t)return;const s=this.ph.audioTracks.getById(t.id);s&&this.ph.audioTracks[c](s,!0,i)}si(){return Array.from(this.ri).find(i=>i.enabled)}wi(i){const{current:t}=i.detail;if(!t)return;const s=this.ri.getTrackById(t.id);if(s){const a=this.si();a&&(a.enabled=!1),s.enabled=!0}}}class B{constructor(i){this.j=i}setup(i){new D(this,i),"audioTracks"in this.media&&new U(this,i)}get type(){return""}get media(){return this.j}get paused(){return this.j.paused}get muted(){return this.j.muted}set muted(i){this.j.muted=i}get volume(){return this.j.volume}set volume(i){this.j.volume=i}get currentTime(){return this.j.currentTime}set currentTime(i){this.j.currentTime=i}get playsinline(){return this.j.hasAttribute("playsinline")}set playsinline(i){I(this.j,"playsinline",i)}get playbackRate(){return this.j.playbackRate}set playbackRate(i){this.j.playbackRate=i}async play(){return this.j.play()}async pause(){return this.j.pause()}async loadSource({src:i},t){this.j.preload=t,C(i)?this.j.srcObject=i:(this.j.srcObject=null,this.j.src=P(i)?i:window.URL.createObjectURL(i)),this.j.load()}}export{B as H,V as a};
